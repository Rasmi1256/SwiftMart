// schema.prisma

// 1. Define the database provider
datasource db {
  provider = "postgresql"
 
}

// 2. Define the Prisma Client generator
generator client {
  provider = "prisma-client"
  output   = "../src/generated/prisma"
}

// ----------------------------------------------------
// 3. Notification Models
// ----------------------------------------------------

/// The InAppNotification model stores persistent notifications for users.
model InAppNotification {
  // Primary key and ID
  id        String   @id @default(uuid())

  // References user _id from User Service
  userId    String

  // e.g., 'order_status_update', 'promotion', 'welcome'
  type      String

  // The main notification content
  message   String

  // Extra data like orderId, newStatus (Schema.Types.Mixed equivalent)
  data      Json?

  // Whether the user has viewed the notification
  read      Boolean  @default(false)

  // Timestamp of creation
  createdAt DateTime @default(now())

  // Composite index for efficient querying by userId, sorted by createdAt descending
  @@index([userId, createdAt(sort: Desc)])

  @@map("InAppNotification")
}

// ---

/// The NotificationPreference model stores a user's chosen notification settings and contact details.
model NotificationPreference {
  // Primary key
  id                String   @id @default(uuid())

  // The unique reference to the User Service ID (Mongoose unique: true equivalent)
  userId            String   @unique

  // Channel toggles (Booleans)
  emailEnabled      Boolean  @default(true)
  smsEnabled        Boolean  @default(false)
  inAppEnabled      Boolean  @default(true)
  pushEnabled       Boolean  @default(false)

  // Contact details and Push token (Mongoose optional fields equivalent)
  emailAddress      String?
  phoneNumber       String?
  fcmToken          String?

  // Timestamps
  createdAt         DateTime @default(now())
  // Mongoose pre('save') and pre('findOneAndUpdate') logic is handled by @updatedAt
  updatedAt         DateTime @updatedAt

  @@map("NotificationPreference")
}