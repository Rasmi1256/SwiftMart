generator client {
  provider = "prisma-client"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
  
}

//
// =========================
// CATEGORY MODEL
// =========================
//

model Category {
  id              String     @id @default(uuid()) @db.Uuid
  name            String     @unique
  description     String?
  imageUrl        String?
  slug            String     @unique

  parentCategoryId String?   @db.Uuid
  parentCategory   Category? @relation("CategoryHierarchy", fields: [parentCategoryId], references: [id])
  children         Category[] @relation("CategoryHierarchy")

  // Relations to Product
  products         Product[]  @relation("MainCategory")
  subProducts      Product[]  @relation("SubCategory")

  createdAt        DateTime   @default(now())
  updatedAt        DateTime   @updatedAt

  @@map("categories")
}

//
// =========================
// PRODUCT MODEL
// =========================
//

model Product {
  id              String     @id @default(uuid()) @db.Uuid
  name            String
  description     String

  /// ---- PRICE FIELDS ---- ///
  priceCurrent        Float
  priceUnit           String
  priceCurrency       String?     @default("USD")
  pricePrevious       Float?
  priceEffectiveDate  DateTime?

  unit             String

  /// ---- CATEGORY RELATIONS ---- ///
  categoryId       String     @db.Uuid
  category         Category   @relation("MainCategory", fields: [categoryId], references: [id])

  subCategoryId    String?    @db.Uuid
  subCategory      Category?  @relation("SubCategory", fields: [subCategoryId], references: [id])

  brand            String?
  SKU              String      @unique

  imageUrl         String
  thumbnailUrl     String?

  /// ---- FLEXIBLE DATA ---- ///
  nutritionalInfo  Json?
  tags             String[]

  /// ---- WEIGHT ---- ///
  weightValue      Float?
  weightUnit       String?

  /// ---- DIMENSIONS ---- ///
  dimensionLength  Float?
  dimensionWidth   Float?
  dimensionHeight  Float?
  dimensionUnit    String?

  averageRating    Float       @default(0)
  reviewCount      Int         @default(0)

  isAvailable      Boolean?    @default(true)

  createdAt        DateTime    @default(now())
  updatedAt        DateTime    @updatedAt

  @@map("products")
}
