// schema.prisma

// 1. Define the database provider
datasource db {
  provider = "postgresql"
}

// 2. Define the Prisma Client generator
generator client {
  provider = "prisma-client-js"
}

// ----------------------------------------------------
// 3. Order Service Models
// ----------------------------------------------------

/// Represents a customer order, including status, financials, and logistics IDs.
model Order {
  // Primary key
  id String @id @default(uuid())

  // References to external services (User, Delivery, Address)
  userId            String // References user _id from User Service
  driverId          String? // References driver _id from Delivery Service
  shippingAddressId String? // References Address _id from User Service or Address Service

  // Order Financials
  totalAmount    Float
  discountAmount Float @default(0)
  finalTotal     Float

  // Payment Details
  paymentMethod String?
  paymentStatus PaymentStatus @default(pending)

  // Order Status & Logistics
  status     OrderStatus @default(pending)
  couponCode String?

  // Timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relationship to OrderItem
  items OrderItem[]

  // Indexes for efficient querying
  @@index([userId])
  @@index([status])
  @@map("Order")
}

/// OrderItem model
model OrderItem {
  id String @id @default(uuid())

  // Foreign Key to the Order model
  orderId String
  order   Order  @relation(fields: [orderId], references: [id])

  // Product Details (from Product Catalog Service)
  productId       String
  productName     String
  productImageUrl String?
  unitPrice       Float
  quantity        Int
  discountApplied Float   @default(0)

  // Timestamps
  createdAt DateTime @default(now())

  @@index([orderId])
  @@map("OrderItem")
}

// ----------------------------------------------------
// 4. Enums for Status Management
// ----------------------------------------------------

enum OrderStatus {
  pending
  placed
  assigned
  picked_up
  delivered
  cancelled
}

enum PaymentStatus {
  pending
  paid
  failed
  refunded
}
